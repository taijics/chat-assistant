# 微信聊天助手开发规划

## 一、需求分解与场景覆盖

1. **历史聊天内容采集**
   - 微信聊天记录批量导入（剪贴板、拖拽、文件、OCR等方式）
   - 结构化存储到本地数据库，支持多会话、多客户管理

2. **实时聊天内容采集**
   - 及时获取微信窗口最新消息
   - 支持自动/手动采集（截图OCR、剪贴板监听、窗口文本采集等）

3. **智能上下文构建**
   - 自动将历史+最新聊天内容与当前提问合并，作为AI输入上下文
   - 支持上下文长度优化与裁剪

4. **AI智能回复**
   - 用户提问后，助手自动检索相关聊天内容、构建Prompt，提交到AI接口，返回答案

5. **基础管理功能**
   - 客户列表、聊天记录检索、消息编辑/删除
   - 聊天内容安全加密存储
   - 导入内容预览与修正

6. **扩展功能建议**
   - 支持多微信账号
   - 支持导出/备份聊天数据库
   - 支持多模型切换
   - 支持多语言
   - 支持自动分组/标签客户

---

## 二、开发先后顺序

1. 数据存储与基础模型搭建
2. 历史聊天内容采集（剪贴板、拖拽、文件导入、OCR识别）
3. 实时聊天内容采集（剪贴板监听、OCR窗口采集、自动采集定时器/快捷键触发）
4. 上下文与客户管理（客户列表、会话管理界面、消息检索/编辑）
5. AI智能回复整合（提问界面、上下文构建、AI接口答复）
6. 权限/安全/扩展（加密、备份、多账号、多模型、多语言、分组标签）

---

## 三、详细开发文档（模块拆解）

### 1. 本地数据结构与接口

- 客户表（customer）：微信号、昵称、分组、标签
- 会话表（conversation）：客户ID、会话时间、会话类型
- 消息表（message）：会话ID、发送方、时间、内容、消息类型
- 数据库API：增删查改、检索

### 2. 聊天内容采集

#### 2.1 剪贴板采集
- 主动点击“导入”或自动检测微信内容格式，解析结构化存储

#### 2.2 拖拽/文件采集
- 支持微信导出的txt/html文件拖拽
- 解析消息流，归档到会话

#### 2.3 OCR识别
- 支持截图，自动OCR识别文本
- 归档到指定客户/会话

#### 2.4 实时内容采集
- 剪贴板监听
- 微信窗口定时截图OCR（如每5秒/快捷键触发）
- 用户主动“采集最新消息”按钮

### 3. 客户与会话管理

- 客户列表展示
- 会话历史检索
- 消息增删查改
- 分组/标签功能

### 4. AI上下文构建与问答

- 用户提问时，自动检索目标客户/会话历史与最新消息
- 构建上下文Prompt，提交到AI（Coze/豆包等）
- 显示回复，支持上下文跟进

### 5. UI/UX交互

- 主窗口：客户列表、会话详情、导入入口、AI问答区
- 导入预览界面，支持人工修正
- 聊天内容展示区，支持检索/筛选/编辑
- AI回复展示区，支持追问/上下文跟进

### 6. 扩展与安全

- 数据加密存储
- 聊天数据库导出/备份/恢复
- 多微信账号管理
- 多模型/多语言支持
- 客户自动分组/标签

---

## 四、可能遗漏的关键场景/建议

- 聊天内容去重/归档：导入时自动去重，避免重复消息
- 客户身份识别与合并：支持同名客户的手动合并
- 敏感信息安全提示：导入时对敏感词、隐私信息自动提示
- AI Prompt长度限制和智能裁剪：自动根据模型token限制智能筛选历史消息
- 自动化导入向导：检测到微信新内容自动弹窗提示导入
- 多平台适配：后续支持Mac/Linux微信
- 权限管控：防止越权读取/导入非本人数据
- 高性能数据库选型：后续数据量大考虑迁移sqlite/leveldb

---

## 五、数据库表结构设计（建议）

### customers（微信客户表）

| 字段      | 类型       | 说明                    |
| --------- | ---------- | ----------------------- |
| id        | 主键/字符串 | 客户唯一ID（微信号或内部生成） |
| nickname  | 字符串     | 微信昵称                |
| remark    | 字符串     | 备注/标签               |
| avatar    | 字符串     | 头像URL（可选）         |

### conversations（会话表）

| 字段         | 类型       | 说明           |
| ------------ | ---------- | -------------- |
| id           | 主键/字符串 | 会话唯一ID     |
| customer_id  | 外键/字符串 | 所属客户ID     |
| started_at   | 时间戳     | 会话开始时间   |
| ended_at     | 时间戳     | 会话结束时间   |
| title        | 字符串     | 会话标题/备注  |

### messages（消息表）

| 字段           | 类型       | 说明                   |
| -------------- | ---------- | ---------------------- |
| id             | 主键/字符串 | 消息唯一ID             |
| conversation_id | 外键/字符串 | 所属会话ID             |
| sender         | 字符串     | 发送方昵称/微信号      |
| sent_at        | 时间戳     | 消息发送时间           |
| type           | 字符串     | 消息类型（文本/图片等）|
| content        | 字符串     | 消息内容               |

---

## 六、开发流程图（顺序）

1. 设计数据库结构，集成本地数据库
2. 实现聊天内容采集（剪贴板、拖拽、文件、OCR），解析存储
3. 实现实时内容采集（剪贴板监听、OCR窗口采集），归档到会话
4. 完善客户/会话管理UI与逻辑
5. 集成AI问答（上下文构建、AI接口、答案展示）
6. 完善交互（导入预览、编辑、检索、追问）
7. 增加安全与扩展功能（加密、备份、分组、标签、自动化）

---

## 七、技术选型

- Electron
- nedb/sqlite3
- OCR服务（腾讯/百度/阿里）
- Coze/豆包等AI模型
- 前端框架可选：原生/React/Vue（根据项目现状）

---

## 八、建议与备忘

- 支持多种导入方式，提升易用性
- 客户分组、标签管理，方便业务拓展
- 导入后自动预览与修正，防止误操作
- 聊天内容加密存储，保障隐私
- 支持多微信号和多模型，后续可扩展
